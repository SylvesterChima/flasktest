<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat</title>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/static/minichat.css" />
    </head>
    <body>
        <section id="start-chat-container">
            <div class="start-chat">
                <div class="container">
                    <h3>Now Chatting</h3>
                    <p>Hi, I am around click 'Start Chat' to contact me.</p>
                </div>
            </div>
            <div class="container mt-5">
                <div class="mb-3">
                    <input type="text" class="form-control" id="name" placeholder="type your name here">
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" id="email" placeholder="name@example.com">
                </div>
                <div class="mt-5">
                    <button type="button" class="btn btn-primary btn-lg btn-block" id="startchat">Start Chat</button>
                </div>
            </div>
        </section>
        <section id="chat-container">
            <div class="head-box-1">
                <div class="container">
                    <ul class="msg-box list-inline text-left d-inline-block float-left">
                        <li> 
                            <img src="https://i.ibb.co/fCzfFJw/person.jpg" alt="" width="40px"> 
                            <span> {{orgname}} </span>
                            <small id="mTest" class="timee"> 12:45 Pm </small> 
                        </li> 
                    </ul>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                    <div class="message-box">
                            <div class="msg_history">
                                <div class="incoming_msg">
                                <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                                <div class="received_msg">
                                    <div class="received_withd_msg">
                                    <p>Hi, How are you ?</p>
                                    <span class="time_date"> 11:01 AM    |    June 9</span></div>
                                </div>
                                </div>
                                <div class="outgoing_msg">
                                <div class="sent_msg">
                                    <p>Hello, i am fine thankyou, what about you ?</p>
                                    <span class="time_date"> 11:01 AM    |    June 9</span> </div>
                                </div>
                                <div class="incoming_msg">
                                <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                                <div class="received_msg">
                                    <div class="received_withd_msg">
                                    <p>I am also good thankyou!</p>
                                    <span class="time_date"> 11:01 AM    |    Yesterday</span></div>
                                </div>
                                </div>
                                <div class="outgoing_msg">
                                <div class="sent_msg">
                                    <p> ok </p>
                                    <span class="time_date"> 11:01 AM    |    Today</span> </div>
                                </div>
                                <div class="incoming_msg">
                                <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                                <div class="received_msg">
                                    <div class="received_withd_msg">
                                    <p> What's going on ?</p>
                                    <span class="time_date"> 11:01 AM    |    Today</span></div>
                                </div>
                                </div>
                            </div>
                    </div>
                    </div>
                </div>
            </div>
            <div class="send-message">
                <div class="container">
                    <form action="" method="">
                        <textarea cols="10" rows="2" class="form-control" id="message" placeholder="Type your message here ..."> </textarea>
                        <ul class="list-inline">
                        <li id="sendM"> <i class="fas fa-paper-plane"></i> </li>
                        </ul>
                    </form>
                </div>
            </div>
        </section>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" ></script>

        <script type="text/javascript" charset="utf-8">
            //function validateEmail(email) {
            //    const re = /\S+@\S+\.\S+/;
            //    return re.test(email);
            //}
            var socket = io({autoConnect: false});
            document.getElementById("startchat").addEventListener("click", function() {
                let name = document.getElementById("name").value;
                let email = document.getElementById("email").value;
                //if(Boolean(name) === false || Boolean(email) === false){
                //    return;
                //}
                //if(validateEmail(email) == false){
                //    return;
                //}
                socket.connect();
                socket.on("connect", function() {
                    console.log('{{chatsession}}')
                    socket.emit("user_connected", {"name": name, "email": email, "chatsession": '{{chatsession}}'});
                })
                document.getElementById("chat-container").style.display = "block";
                document.getElementById("start-chat-container").style.display = "none";
            })

            document.getElementById("sendM").addEventListener("click", function(){
                let message = document.getElementById("message").value;
                socket.emit("new_message", {"name": name, "email": email, "chatsession": '{{chatsession}}', "message": message});
                document.getElementById("message").value = "";
            });

            socket.on("chat", function(data) {
                console.log(data)
                //let ul = document.getElementById("chat-messages");
                //let li = document.createElement("li");
                //li.appendChild(document.createTextNode(data["username"] + ": " + data["message"]));
                //ul.appendChild(li);
                //ul.scrolltop = ul.scrollHeight;
            })
        </script>
    </body>
</html>



